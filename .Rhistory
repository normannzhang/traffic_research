)
p <- ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_scaled, text = paste0("Year: ", YEAR, "<br>% Severe: ", percent(pct_change, accuracy = 0.1))),
color = '#EF002B', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = '#EF002B'),
axis.text.y.right = element_text(color = '#EF002B', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0)
)
ggplotly(p, tooltip = "text")
}
bar_circle_plot(model_df)
library(plotly)
install.packages('plotly')
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(
pct_change = severe_crashes / total_crashes,
pct_scaled = pct_change * max(total_crashes)
)
p <- ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_scaled, text = paste0("Year: ", YEAR, "<br>% Severe: ", percent(pct_change, accuracy = 0.1))),
color = '#EF002B', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = '#EF002B'),
axis.text.y.right = element_text(color = '#EF002B', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0)
)
ggplotly(p, tooltip = "text")
}
bar_circle_plot(model_df)
library(plotly)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(
pct_change = severe_crashes / total_crashes,
pct_scaled = pct_change * max(total_crashes)
)
p <- ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_scaled, text = paste0("Year: ", YEAR, "<br>% Severe: ", percent(pct_change, accuracy = 0.1))),
color = '#EF002B', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = '#EF002B'),
axis.text.y.right = element_text(color = '#EF002B', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0)
)
ggplotly(p, tooltip = "text")
}
bar_circle_plot(model_df)
library(scales)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(
pct_change = severe_crashes / total_crashes,
pct_scaled = pct_change * max(total_crashes)
)
p <- ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_scaled, text = paste0("Year: ", YEAR, "<br>% Severe: ", percent(pct_change, accuracy = 0.1))),
color = '#EF002B', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = '#EF002B'),
axis.text.y.right = element_text(color = '#EF002B', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0)
)
ggplotly(p, tooltip = "text")
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(
pct_change = severe_crashes / total_crashes,
pct_scaled = pct_change * max(total_crashes)
)
p <- ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes, text = paste0("Year: ", YEAR, "\nTotal Crashes: ", total_crashes)),
fill = '#B3DDF2') +
geom_point(aes(y = pct_scaled, text = paste0("Year: ", YEAR, "<br>Severe Crash Rate: ", percent(pct_change, accuracy = 0.1))),
color = '#EF002B', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = '#EF002B'),
axis.text.y.right = element_text(color = '#EF002B', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0)
)
ggplotly(p, tooltip = "text")
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = YEAR)) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)), color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes), name = '% of Crashes That Were Severe', labels = scales::percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red line = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold')
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold'),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0, size = 10)
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 16),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0, size = 10)
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 12),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0, size = 10)
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 10),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold'),
axis.text.x = element_text(angle = 0, size = 10)
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 10),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold', size = 10),
axis.text.x = element_text(angle = 0, size = 10)
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 11),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold', size = 11),
axis.text.x = element_text(angle = 0, size = 10)
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 11),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold', size = 11),
axis.text.x = element_text(angle = 0, size = 12, face = 'bold')
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 11),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold', size = 11),
axis.text.x = element_text(angle = 0, size = 12, face = 'bold'),
axis.text.y = element_text(angle = 0, size = 12, face = 'bold')
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 12),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold', size = 12),
axis.text.x = element_text(angle = 0, size = 12, face = 'bold'),
axis.text.y = element_text(angle = 0, size = 12, face = 'bold')
)
}
bar_circle_plot(model_df)
bar_circle_plot <- function(data) {
df <- data |>
group_by(YEAR) |>
summarise(
total_crashes = n(),
severe_crashes = sum(severe == 1)
) |>
mutate(pct_change = severe_crashes / total_crashes)
ggplot(df, aes(x = factor(YEAR))) +
geom_col(aes(y = total_crashes), fill = '#B3DDF2') +
geom_point(aes(y = pct_change * max(total_crashes)),
color = 'firebrick', size = 3.5) +
scale_y_continuous(
name = 'Total Crashes',
sec.axis = sec_axis(~ . / max(df$total_crashes),
name = '% of Crashes That Were Severe',
labels = percent_format(accuracy = 0.1))
) +
labs(
x = 'Year',
caption = 'Shaded bars = total crashes | Red dots = % of crashes that were severe'
) +
theme_minimal() +
theme(
axis.title.y.right = element_text(color = 'firebrick'),
axis.text.y.right = element_text(color = 'firebrick', face = 'bold', size = 12),
axis.title.y.left = element_text(color = '#B3DDF2', face = 'bold', size = 12),
axis.text.x = element_text(angle = 0, size = 12, face = 'bold'),
axis.text.y = element_text(angle = 0, size = 12, face = 'bold'),
axis.title.x = element_text(size = 12, face = 'bold')
)
}
bar_circle_plot(model_df)
runApp()
runApp()
